---
title: "ANS extension: Function-on-scalar regression"
author: "Lorenzo Testa"
date: "1/23/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(refund)
library(tidyverse)
library(readr)
```

## Data preparation

We have to import both scalar covariates and functional responses for the following regressions.

```{r cars}
covariates=read_csv('covariates_for_R.csv')
response=read_csv('responses_for_R.csv')
```

Note that covariates have already been preprocessed in Python. We need to perform some transpositions and row to column stuff (refund is very restrictive in terms of admissible inputs).

```{r}
covariates=column_to_rownames(covariates, 'idx') 
covariates=covariates[,-c(1:3)] # remove controls
covariates=as.matrix(cbind(1, covariates))
response=response[, -1]
response=t(response)
```


## Function-on-scalar regression

Here we run the regression on a subset of covariates (see Python for feature selection)

```{r pressure, ec}
rows=c(1,2,3)
olsmod = fosr(Y=response[complete.cases(covariates[,rows]),], X = covariates[complete.cases(covariates[,rows]),rows], method='OLS', lambda=0.000001)
```

... And we save the results -- going back to Python

```{r}
coef_estimate=as.data.frame(olsmod$est.func)
se_estimate=as.data.frame(olsmod$se.func)

write_csv(coef_estimate, 'funcoef_estimate.csv')
write_csv(se_estimate, 'funse_estimate.csv')
```

Done! :-)
